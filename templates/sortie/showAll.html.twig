{% extends 'base.html.twig' %}
{% block css %}
    {{ parent() }}
{% endblock %}

{% block title %}
    {{ parent() }} List
{% endblock %}

{% block body %}



    {% include('bodyStructures/forms/filtreForm.html.twig') %}
    <div class="centre_tableau">
        <table class="" >
            <tr>
                <th>Nom de la sortie</th>
                <th>Date de la sortie</th>
                <th>Clotûre</th>
                <th>Inscrit/place</th>
                <th>Etat</th>
                <th>Inscrit</th>
                <th>Organisateur</th>
                <th>Action</th>
            </tr>

            {% for sort in sorties %}
                <tr>
                    <td class=""> {{ sort.nom }}</td>
                    <td> {{ sort.dateHeureDebut| date('d/m/Y H:i') }}</td>
                    <td> {{ sort.dateLimiteInscription | date ('d/m/Y') }}</td>
                    <td> {{ sort.participants.count() }}/{{ sort.nbInsriptionsMax }}</td>
                    <td> {{ sort.etat.libelle }}</td>
                    <td>
                        {% if(sort.participants.contains(app.user)) %}
                            X
                        {% endif %}
                    </td>

                    <td>
                        <a href="{{ path('user_show', {'id': sort.organisateur.id}) }}">{{ sort.organisateur.pseudo }}</a>
                    </td>

                    <td>
                        {% if(sort.organisateur == app.user) %}
                            {% if(sort.etat.libelle ==  'Créée') %}
                                <a href="{{ path('sortie_show_one', {'id': sort.id}) }}"><button type="button" class="btn btn-secondary">Afficher</button></a>
                                <a href="{{ path('sortie_update', {'id': sort.id}) }}"><button type="button" class="btn btn-primary">Modifier</button></a>
                                <a href="{{ path('sortie_publish', {'id': sort.id}) }}"><button type="button" class="btn btn-success">Publier</button></a>
                            {% elseif(sort.etat.libelle ==  'Ouverte') %}
                                <a href="{{ path('sortie_show_one', {'id': sort.id}) }}"><button type="button" class="btn btn-secondary">Afficher</button></a>
                                <a href="{{ path('sortie_cancel', {'id': sort.id}) }}"><button type="button" class="btn btn-warning">Annuler</button></a>
                            {% elseif(sort.etat.libelle ==  'Clôturée') %}
                                <a href="{{ path('sortie_show_one', {'id': sort.id}) }}"><button type="button" class="btn btn-secondary">Afficher</button></a>
                                <a href="{{ path('sortie_cancel', {'id': sort.id}) }}"><button type="button" class="btn btn-warning">Annuler</button></a>
                            {% elseif(sort.etat.libelle ==  'Activité en cours') %}
                                <a href="{{ path('sortie_show_one', {'id': sort.id}) }}"><button type="button" class="btn btn-secondary">Afficher</button></a>
                            {% elseif(sort.etat.libelle ==  'Passée') %}
                                <a href="{{ path('sortie_show_one', {'id': sort.id}) }}"><button type="button" class="btn btn-secondary">Afficher</button></a>
                            {% elseif(sort.etat.libelle ==  'Annulée') %}
                                <a href="{{ path('sortie_show_one', {'id': sort.id}) }}"><button type="button" class="btn btn-secondary">Afficher</button></a>
                            {% endif %}
                        {% else %}
                            {% if(sort.etat.libelle ==  'Créée') %}
                                <a href="{{ path('sortie_show_one', {'id': sort.id}) }}"><button type="button" class="btn btn-secondary">Afficher</button></a>
                            {% elseif(sort.etat.libelle ==  'Ouverte') %}
                                {% if(sort.participants.contains(app.user)) %}
                                    <a href="{{ path('sortie_show_one', {'id': sort.id}) }}"><button type="button" class="btn btn-secondary">Afficher</button></a>
                                    <a href="{{ path('sortie_unsubscride', {'id': sort.id}) }}"><button type="button" class="btn btn-danger">Se désister</button></a>
                                {% else %}
                                    <a href="{{ path('sortie_show_one', {'id': sort.id}) }}"><button type="button" class="btn btn-secondary">Afficher</button></a>
                                    {% if sort.dateLimiteInscription > date('now') %}
                                        <a href="{{ path('sortie_subscribe', {'id': sort.id}) }}"><button type="button" class="btn btn-primary">S'inscrire</button></a>
                                    {% endif %}
                                {% endif %}
                                {% if(app.user.roles[0] == 'ROLE_ADMIN') %}
                                    <a href="{{ path('sortie_cancel', {'id': sort.id}) }}"><button type="button" class="btn btn-warning">Annuler</button></a>
                                {% endif %}
                            {% elseif(sort.etat.libelle ==  'Clôturée') %}
                                <a href="{{ path('sortie_show_one', {'id': sort.id}) }}"><button type="button" class="btn btn-secondary">Afficher</button></a>
                                {% if(sort.participants.contains(app.user)) %}
                                    <a href="{{ path('sortie_unsubscride', {'id': sort.id}) }}"><button type="button" class="btn btn-danger">Se désister</button></a>
                                {% endif %}
{#                                {% if is_granted("ROLE_ADMIN") %}#}
                                {% if(app.user.roles[0] == 'ROLE_ADMIN') %}
                                    <a href="{{ path('sortie_cancel', {'id': sort.id}) }}"><button type="button" class="btn btn-warning">Annuler</button></a>
                                {% endif %}
                            {% elseif(sort.etat.libelle ==  'Activité en cours') %}
                                <a href="{{ path('sortie_show_one', {'id': sort.id}) }}"><button type="button" class="btn btn-secondary">Afficher</button></a>
                            {% elseif(sort.etat.libelle ==  'Passée') %}
                                <a href="{{ path('sortie_show_one', {'id': sort.id}) }}"><button type="button" class="btn btn-secondary">Afficher</button></a>
                            {% elseif(sort.etat.libelle ==  'Annulée') %}
                                <a href="{{ path('sortie_show_one', {'id': sort.id}) }}"><button type="button" class="btn btn-secondary">Afficher</button></a>
                            {% endif %}
                        {% endif %}
                    </td>
                </tr>
            {% endfor %}
        </table>
    </div>
    <div class="inline">
        {% if currentPage > 1 %}
            <a href="{{ path('sortie_show_all', {'page': currentPage-1}) }}"><button type="button" class="btn btn-secondary">Page Précédente</button></a>
        {% endif %}
        <div><b>{{ currentPage }}/{{ maxPage }}</b></div>
        {% if currentPage < maxPage %}
            <a href="{{ path('sortie_show_all', {'page': currentPage+1}) }}"><button type="button" class="btn btn-secondary">Page Suivante</button></a>
        {% endif %}
    </div>
    <div class="btn_centrer">
        <a href="{{ path('sortie_add') }}">
            <button type="button" class="btn btn-primary ">Créer une sortie</button>
        </a>
    </div>
{% endblock %}

